var itraceBlankPlugin=function(){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.apply(null,arguments)}function t(e,r){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},t(e,r)}var r;(r={}).ZH="cn",r.QUARK="quark",r.INTL="intl";var n=function(e){return e[e.JSERR=1]="JSERR",e[e.API=2]="API",e[e.PERF=3]="PERF",e[e.RESERR=4]="RESERR",e[e.PVUV=5]="PVUV",e[e.BKPG=6]="BKPG",e[e.LONGTASK=8]="LONGTASK",e[e.INPD=15]="INPD",e[e.NODERES=16]="NODERES",e[e.PGERROR=17]="PGERROR",e[e.BLOCK=18]="BLOCK",e[e.PERFNEXT=1e3]="PERFNEXT",e[e.MAINDOC=1e5]="MAINDOC",e[e.RESTIMING=100001]="RESTIMING",e}({});!function(e){e.JSERR="jserr",e.API="api",e.PERF="jsfsperf",e.RESERR="resloadfail",e.PVUV="flow",e.BKPG="bkpg",e.CUSTOM="jssdkidx",e.INPD="inputdelay",e.LONGTASK="longtask",e.NODERES="nodres",e.PGERROR="pgerror",e.BLOCK="h5block"}({});var o=function(e){e=e||{},this.id=e.id,this.sampleRate=e.sampleRate,this.forceEnable=e.forceEnable};function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i.apply(null,arguments)}function a(e){return"function"==typeof e}function c(){for(var e=arguments.length<=0?void 0:arguments[0],t=1,r=arguments.length;t<r;t++){var n=t<0||arguments.length<=t?void 0:arguments[t];for(var o in n)s(n,o)&&(e[o]=n[o])}return e}function l(e,t,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1),e.addEventListener?e.addEventListener(t,(function i(a){o&&e.removeEventListener(t,i,n),r.call(this,a)}),n):e.attachEvent&&e.attachEvent("on"+t,(function i(a){o&&e.detachEvent(t,i,n),r.call(this,a)}))}!function(e){e.ZH="cn",e.QUARK="quark",e.INTL="intl"}({}),function(e){e[e.JSERR=1]="JSERR",e[e.API=2]="API",e[e.PERF=3]="PERF",e[e.RESERR=4]="RESERR",e[e.PVUV=5]="PVUV",e[e.BKPG=6]="BKPG",e[e.LONGTASK=8]="LONGTASK",e[e.INPD=15]="INPD",e[e.NODERES=16]="NODERES",e[e.PGERROR=17]="PGERROR",e[e.BLOCK=18]="BLOCK",e[e.PERFNEXT=1e3]="PERFNEXT",e[e.MAINDOC=1e5]="MAINDOC",e[e.RESTIMING=100001]="RESTIMING"}({}),function(e){e.JSERR="jserr",e.API="api",e.PERF="jsfsperf",e.RESERR="resloadfail",e.PVUV="flow",e.BKPG="bkpg",e.CUSTOM="jssdkidx",e.INPD="inputdelay",e.LONGTASK="longtask",e.NODERES="nodres",e.PGERROR="pgerror",e.BLOCK="h5block"}({}),"undefined"!=typeof navigator&&(navigator.userAgent||"").toLowerCase();var s=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p=function(e,t){if(!e)return"e";var r=window.getComputedStyle(e);return"0px"===r.width||"0px"===r.height||"none"===r.display||"hidden"===r.visibility||"0"===r.opacity||e.getBoundingClientRect().top>t?"e":-1!==["VIDEO","AUDIO","IMG","BUTTON","TEXTAREA","RADIO","CHECKBOX","SELECT","IFRAME","CANVAS","SVG"].indexOf(e.nodeName)||"none"!==r.backgroundImage?"v":"rgba(0, 0, 0, 0)"!==r.backgroundColor||"0px"!==r.borderWidth||"none"!==r.boxShadow?"ve":"oc"};var u=function(r){function o(e){var t;(t=r.call(this,e)||this).reporter=null,t.pluginVer="2.3.0";return t.opts=c({maxDepth:8,minElements:10,startCheckingTime:5e3},e),t}!function(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,t(e,r)}(o,r);var s=o.prototype;return s.init=function(e){var t,r,n,o=this,c=this;c.reporter=e;try{if(c.opts.ignorePageUrls&&a(c.opts.ignorePageUrls)&&c.opts.ignorePageUrls(location))return void c.reporter.print("current url is in ignore list, skip blank check");this.reporter.detectBlank=function(e){o._checkBlank(e)}}catch(e){this.reporter.print(e)}if(null!=(t=this.reporter._sdkEnv)&&t.iOSNBCheck)return function(e,t,r,n){var o;if("function"==typeof(null==(o=window)||null==(o=o.ucapi)?void 0:o.invoke)){var a=i({},t,{success:r,fail:n});window.ucapi.invoke(e,a)}else n&&n("ucapi is not exist")}("webMonitor.setConfig",{startCheckingTime:this.opts.startCheckingTime,frmId:this.reporter._frmId,sampleRate:this.opts.sampleRate,w_rel:this.reporter.rel,uid:this.reporter.uid}),void this.reporter.print("blank check will be performed by client");var s=null==(r=this.reporter._sdkEnv)?void 0:r.isPrerender;!function(e){var t;return void 0===e&&(e={}),e.isPrerender?"compass"===e.prerenderType?"object"==typeof(null==(t=window)?void 0:t.prerenderCommitEvent)&&"prerendercommit"===window.prerenderCommitEvent.type:e.hasPrerenderCommit:"complete"===document.readyState}(this.reporter._sdkEnv)?function(e,t){l(window,t?"wpkpageforeground":"load",(function(r){t&&"complete"!==document.readyState?l(window,"load",(function(t){e.call(null,t)}),!1,!0):e.call(null,r)}),!1,!0)}((function(){c._onloadBlankCheck()}),s):c._onloadBlankCheck(),null!=(n=this.opts.spaOption)&&n.enable&&l(window,"wpkpgchange",(function(){o.reporter.print("spa page change blank detect"),c._routeChangeBlankCheck()}))},s._onloadBlankCheck=function(){var e=this;this.onLoadDetectTimer=setTimeout((function(){try{e._checkBlank()}catch(t){e.reporter.print("bkpg checking oops: ",t)}e.onLoadDetectTimer=null}),e.opts.startCheckingTime)},s._routeChangeBlankCheck=function(){var t,r=this;this.onLoadDetectTimer&&(clearTimeout(this.onLoadDetectTimer),r.reporter.print("page changed cancel the blank detect after onload")),this.pageChangeDetectTimer&&clearTimeout(this.pageChangeDetectTimer),this.pageChangeDetectTimer=setTimeout((function(){try{var t,n=e({},r.opts);n.rootDom=(null==(t=n.spaOption)?void 0:t.rootDom)||n.rootDom,r._checkBlank(n)}catch(e){r.reporter.print("bkpg checking oops: ",e)}r.pageChangeDetectTimer=null}),(null==(t=r.opts.spaOption)?void 0:t.startCheckingTime)||3e3)},s._checkBlank=function(t){var r=this,o=t||r.opts,i=document.body;o.rootNode?i=o.rootNode:o.rootDom&&(i="function"==typeof o.rootDom?o.rootDom():o.rootDom);var c,l,s,u,d,h,f,E,g={deepestLayer:0,hasAtLeastOneVisibleNode:!1,total:0,invisible:0,visibleEmpty:0,occupy:0,domDSL:[]},m={},R=-1,v=Date.now();if(i){var k=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}(i.innerText);if(k)c=o.minTextLength||0,l=k,c&&c>0&&l&&c>l.split("").length?R=105:function(e,t){return function(e,t){for(var r,n=0,o=e.length;n<o;n++)if(r=e[n],t.call(this,r))return!0;return!1}(e,(function(e){return e===t}))}(o.keyNoteText||[],k)&&(R=102);else{var y=function(e,t){var r=[];try{for(var n=0,o=e.length;n<o;n++)t.call(this,e[n],n,e)&&r.push(e[n]);return r}catch(e){}return e}(Array.prototype.slice.call(i.children),(function(e){return-1===["STYLE","SCRIPT","LINK"].indexOf(e.nodeName)}));s=y,u=o.maxDepth||8,d=o.minElements||4,f=!0,E=function(e,t){var r=Array.prototype.slice.call(e),n=window.innerHeight;for(t>h.deepestLayer&&(h.deepestLayer=t);r.length&&f;){var o=r.shift();h.total++;var i=p(o,n);if(h.domDSL.push({tag:o.tagName,layer:t,cls:o.className,isEmpty:"e"===i||"oc"===i}),"e"!==i){if("v"===i){h.hasAtLeastOneVisibleNode=!0,f=!1;break}if("ve"===i&&(h.visibleEmpty++,d&&h.visibleEmpty>d)){f=!1;break}"oc"===i&&h.occupy++,t<=u&&o.children.length&&E(o.children,t+1)}else h.invisible++}},(h={deepestLayer:0,hasAtLeastOneVisibleNode:!1,total:0,invisible:0,visibleEmpty:0,occupy:0,domDSL:[]}).deepestLayer=1,E(s,1),!(g=h).hasAtLeastOneVisibleNode&&g.visibleEmpty<(o.minElements||4)&&(R=101,m={wl_ven:g.visibleEmpty,wl_ocn:g.occupy})}}else R=103;var O=Date.now()-v;r.reporter.print("节点总数："+g.total+", 最大层深："+g.deepestLayer+", 耗时："+O);var b={w_fp:-1};if(R>=0){r.reporter.print("检测到白屏，白屏类型："+R),b=e({w_fp:R,w_dsl:JSON.stringify(g.domDSL),w_depth:g.deepestLayer,w_domcnt:g.total,wl_dcost:O},m),r.sendData(b);var P=document.documentElement.innerHTML||"";P.length<=1e5&&r.reporter.report({category:n.MAINDOC,sampleRate:1,bl1:P,_forcePost:!0}),r.reporter._hasCollectResTiming||(r.reporter.report({category:n.RESTIMING,bl1:JSON.stringify(performance.getEntriesByType("resource")),bl2:performance.timeOrigin||performance.timing.fetchStart,_forcePost:!0}),r.reporter._hasCollectResTiming=!0)}try{o.callback&&a(o.callback)&&o.callback(b)}catch(e){this.reporter.print("blank callback error",e)}},s.sendData=function(e){c(e,{category:n.BKPG,sampleRate:this.sampleRate,pluginVer:this.pluginVer}),this.reporter.report(e)},o}(o);return u.pluginId="iTraceBlankPlugin",u}();
var itraceNext=function(t){"use strict";function e(t,r){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,r)}var r=function(t){return t.ZH="cn",t.QUARK="quark",t.INTL="intl",t}({});!function(t){t[t.JSERR=1]="JSERR",t[t.API=2]="API",t[t.PERF=3]="PERF",t[t.RESERR=4]="RESERR",t[t.PVUV=5]="PVUV",t[t.BKPG=6]="BKPG",t[t.LONGTASK=8]="LONGTASK",t[t.INPD=15]="INPD",t[t.NODERES=16]="NODERES",t[t.PGERROR=17]="PGERROR",t[t.BLOCK=18]="BLOCK",t[t.PERFNEXT=1e3]="PERFNEXT",t[t.MAINDOC=1e5]="MAINDOC",t[t.RESTIMING=100001]="RESTIMING"}({});var n=function(t){return t.JSERR="jserr",t.API="api",t.PERF="jsfsperf",t.RESERR="resloadfail",t.PVUV="flow",t.BKPG="bkpg",t.CUSTOM="jssdkidx",t.INPD="inputdelay",t.LONGTASK="longtask",t.NODERES="nodres",t.PGERROR="pgerror",t.BLOCK="h5block",t}({});function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i.apply(null,arguments)}function o(t){if(c(console)&&d(console.warn)){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=console).warn.apply(e,["[itrace says] "+t].concat(n))}}function s(t){return void 0!==t}function a(t){var e=Date.now();"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:11&r).toString(16)}));return!1===t?r.replace(/-/g,""):r}function c(t){return"object"==typeof t}function u(t){return"[object Array]"==={}.toString.call(t)}function d(t){return"function"==typeof t}function p(t){var e;switch(t){case 1:e=n.JSERR;break;case 2:e=n.API;break;case 3:e=n.PERF;break;case 4:e=n.RESERR;break;case 5:e=n.PVUV;break;case 6:e=n.BKPG;break;case 8:e=n.LONGTASK;break;case 15:e=n.INPD;break;case 16:e=n.NODERES;break;case 17:e=n.PGERROR;break;case 18:e=n.BLOCK;break;default:e=n.CUSTOM}return e}function f(t){var e=+new Date;return!0===t&&(e=Math.floor(e/1e3)),e}function l(t){var e=[];for(var r in t)e.push(r+"="+t[r]);return e.join("&")}function h(t){return!!t&&(t>=1||"100%"===t||(/^\d+(\.\d+)?%$/.test(t)?Math.random()<parseFloat(t)/100:t>0&&t<1&&Math.random()<t))}function g(){for(var t=arguments.length<=0?void 0:arguments[0],e=1,r=arguments.length;e<r;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];for(var i in n)R(n,i)&&(t[i]=n[i])}return t}function v(t,e){if(-1===e)t();else var r=setTimeout((function(){t(),clearTimeout(r)}),e||0)}function y(t,e,r,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),t.addEventListener?t.addEventListener(e,(function o(s){i&&t.removeEventListener(e,o,n),r.call(this,s)}),n):t.attachEvent&&t.attachEvent("on"+e,(function o(s){i&&t.detachEvent(e,o,n),r.call(this,s)}))}function _(t){for(var e in t)0===e.indexOf("_")&&delete t[e];for(var r,n=1;n<=15;n++)R(t,r="bl"+n)&&(t["w_"+r]=t[r],delete t[r]);r=null,function(t,e,r){for(var n,i=e.length,o=0;o<i;o++)"string"==typeof(n=t[e[o]])?t[e[o]]=n.substring(0,r):"object"==typeof n&&(n=JSON.stringify(n),t[e[o]]=n.substring(0,r))}(t,["c1","c2","c3","c4","c5","c6","c7","c8","c9","c10"],128)}var m="undefined"!=typeof navigator?(navigator.userAgent||"").toLowerCase():"";function w(){return m.indexOf("quark/")>-1}function b(t,e,r,n){var o;if("function"==typeof(null==(o=window)||null==(o=o.ucapi)?void 0:o.invoke)){var s=i({},e,{success:r,fail:n});window.ucapi.invoke(t,s)}else n&&n("ucapi is not exist")}var R=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},E=function(t){if(!t)return 0;try{return"function"==typeof TextEncoder?(new TextEncoder).encode(t).length:function(t){for(var e=0,r=0,n=t.length;r<n;r++){var i=t.charCodeAt(r);e+=i<128?1:i<2048?2:i<55296?3:i<56320?4:3}return e}(t)}catch(e){return t.length}},S=function(){function t(t){this.logSrc="jssdk",this.sdkCode="default",t=t||{},this.bid=t.bid||"",this.cid=t.cid||"",this.uid=t.uid||"",this.rel=t.rel||"",this.utdid=t.utdid||void 0,this.debug=t.debug||!1,this.delay=!1!==t.delay,this.cluster=t.cluster||r.ZH,this.sampleRate=t.sampleRate,this.ready=!1,this.plugins=t.plugins||[],this.gateway=t.gateway||""}var e=t.prototype;return e.print=function(){this.debug&&o.apply(void 0,arguments)},e.isReady=function(){return this.ready},e.setReady=function(){this.ready=!0},e.setConfig=function(t){var e=this;if(c(t)){var r=function(r){var n;(function(t,e){for(var r,n=0,i=t.length;n<i;n++)if(r=t[n],e.call(this,r))return!0;return!1})(["plugins"],(function(t){return t===r}))||g(e,((n={})[r]=t[r],n))};for(var n in t)r(n)}},t}(),k=function(){function t(){this.logList=[],this.preLogList=[]}var e=t.prototype;return e.getLogList=function(){return this.logList},e.takeLogList=function(){var t=this.logList;return this.logList=[],t},e.getPreLogList=function(){return this.preLogList},e._updateLogQueue=function(t){var e=this.logList.length,r=!0;if(1!==t.category||0===e)this.logList.push(t);else{for(var n,i=0;i<e;i++)if((n=this.logList[i])._hash===t._hash){n.w_cnt=n.w_cnt?++n.w_cnt:1,r=!1;break}r&&this.logList.push(t)}return r},e.popLog=function(){return this.logList.shift()},e.popPreLog=function(){return this.preLogList.shift()},e.pushLog=function(t){return this._updateLogQueue(t)},e.hasLog=function(){return this.logList&&this.logList.length>0},e.pushPreLog=function(t){this.preLogList.push(t)},e.hasPreLog=function(){return this.preLogList&&this.preLogList.length>0},e.setPreLogList=function(t){void 0===t&&(t=[]),this.preLogList=this.preLogList.concat(t)},e.clearLogList=function(){this.logList=[]},t}(),P=function(t){return t.ZH="cn",t.QUARK="quark",t.INTL="intl",t}({}),L=function(){function t(){}return t.getAddr=function(e,r){return r?""+r+t.uploadPath:""+t.hosts[e.valueOf()]+t.uploadPath},t.getConfAddr=function(e,r){return r?""+r+t.jconfigPath:""+t.hosts[e.valueOf()]+t.jconfigPath},t.getHosts=function(e){return t.hosts[e]},t}();L.hosts={cn:"https://px.effirst.com",intl:"https://px-intl.ucweb.com",quark:"https://px.wpk.quark.cn",er:"https://erpx.effirst.com"},L.uploadPath="/api/v1/jssdk/upload",L.jconfigPath="/api/v1/jconfig";var x=function(t){return t[t.JSERR=1]="JSERR",t[t.API=2]="API",t[t.PERF=3]="PERF",t[t.RESERR=4]="RESERR",t[t.PVUV=5]="PVUV",t[t.BKPG=6]="BKPG",t[t.LONGTASK=8]="LONGTASK",t[t.INPD=15]="INPD",t[t.NODERES=16]="NODERES",t[t.PGERROR=17]="PGERROR",t[t.BLOCK=18]="BLOCK",t[t.PERFNEXT=1e3]="PERFNEXT",t[t.MAINDOC=1e5]="MAINDOC",t[t.RESTIMING=100001]="RESTIMING",t}({});function O(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return I(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}!function(t){t.JSERR="jserr",t.API="api",t.PERF="jsfsperf",t.RESERR="resloadfail",t.PVUV="flow",t.BKPG="bkpg",t.CUSTOM="jssdkidx",t.INPD="inputdelay",t.LONGTASK="longtask",t.NODERES="nodres",t.PGERROR="pgerror",t.BLOCK="h5block"}({});var C,N=window,A=document,j=navigator,B=location,T=void 0!==N.devicePixelRatio?N.devicePixelRatio:1,U="__itrace",D="__itrace_conf",M="__itrace_wid";function G(t,e){for(var r,n,i=t.split("."),o=e.split("."),s=i.length,a=0;a<s;a++)if((r=parseInt(i[a]))!==(n=parseInt(o[a])))return r>n;return!0}function q(t){try{if(s(window)&&window.hasOwnProperty("ucweb")&&window.ucweb.window||s(t)){for(var e=(t||j.userAgent).split(" "),r=e.length,n=!1,i=0;i<r;i++)if(-1!==e[i].indexOf("UWS/")){n=G(e[i].split("/")[1],"2.13.2.37");break}return n||m.indexOf("ucbrowser/")>-1||w()}}catch(t){console.error(t)}return!1}var V=function(){var t,e;return 3===(null==(t=window.ucweb)||null==(t=t.window)||null==(t=t.performance)?void 0:t.pt)||(null==(e=window.compass)||null==(e=e.env)?void 0:e.isPrerender)};function K(t){try{var e="__wpktestingls__";return t().setItem(e,e),t().removeItem(e),!0}catch(t){return!1}}function J(){return localStorage}var F={get:function(t){if(K(J)){var e=J().getItem(t);if(e){if(e=JSON.parse(e),Date.now()<e.expireAt)return e;this.rm(t)}}return null},set:function(t,e){K(J)&&t&&e&&(e.expireAt=Date.now()+18e5,J().setItem(t,JSON.stringify(e)))},rm:function(t){K(J)&&J().removeItem(t)}};function H(){return sessionStorage}var Q=function(t,e){if(!e)return!0;if(!u(e))return!1;if(1===e.length)return t===e[0];if(2===e.length){var r=e[0],n=e[1];return r&&!n?i(t,r):r&&n?i(t,r)&&i(n,t):i(n,t)}return!1;function i(t,e){var r=t.split("."),n=e.split(".");return!(parseInt(r[0])<parseInt(n[0]))&&(parseInt(r[0])>parseInt(n[0])||!(parseInt(r[1])<parseInt(n[1]))&&(parseInt(r[1])>parseInt(n[1])||parseInt(r[2])>=parseInt(n[2])))}};function X(t,e,r,n){var i="itracereporter:dynamicConf:"+t,o=F.get(i);if(o)d(n)&&n(o);else{var s=l({app:t,tm:f(!0),ud:a(),sver:e,sign:"c41e43c828c16c16a6eb1c9c1e68e8ce"});!function(t,e){if("undefined"==typeof XMLHttpRequest)e();else{var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState){var t;if(200===r.status&&r.response)try{var n=JSON.parse(r.response);0===n.code&&(t=n.config||[])}catch(t){}e(t)}};try{r.open("GET",t,!0),r.timeout=3e3,r.send()}catch(t){}}}(r+"?wpk-header="+encodeURIComponent(s),(function(t){if(o={},void 0!==t){for(var r=t.length,s=0;s<r;s++){var a=t[s],c=a.sdkver;if(Q(e,c)){if(a.common&&void 0!==a.common.sampleRate&&(o.all=a.common.sampleRate),a.config)for(var u=a.config.length,p=0;p<u;p++){var f=a.config[p];if(f.type){if(f.category_rate)for(var l in f.category_rate)o[f.type+"@"+l]=f.category_rate[l];f.sampleRate&&(o[f.type]=f.sampleRate)}}break}}try{F.set(i,o)}catch(t){}}d(n)&&n(o)}))}}var z={},W=function(t,e,r,n,i){if(void 0===e){if(!z[t]){var o=null,s=new RegExp(t+"=([^;]+)");try{o=s.exec(A.cookie)}catch(t){return null}o&&(z[t]=o[1])}return z[t]}var a=t+"="+e;n&&(a+="; domain="+n),i&&(a+="; path="+i),r&&(a+="; max-age="+r);try{A.cookie=a}catch(t){return null}return a};var Z=function(t){return"itrace"+(t.replace(/^\S/g,(function(t){return t.toUpperCase()}))+"Plugin")},$=function(t,e){try{var r=Z(e.id),n=window[r];if(d(n))new n(e).init(t),t.print(e.id+" plugin init success");else t.print(e.id+" plugin's constructor is not exist")}catch(r){t.print(e.id+" plugin init fail: ",r)}},Y=function(t,e){try{new(0,e.plugin)(e).init(t),t.print(e.id+" plugin init success by option.plugin")}catch(r){t.print(e.id+" plugin init fail: ",r)}};function tt(t,e){for(var r,n=t._sdkEnv.useU4Monitor,i=["flow","interface","jserror","perf","resource","blank"],o=[],s=[],a=O(e);!(r=a()).done;){var c=r.value,u="string"==typeof c?{id:c,plugin:null}:c;if(u.id){if(n&&i.includes(u.id)&&!u.forceEnable){if(t.print("uccore monitor has been enabled, so ["+u.id+"] plugin will be ignore. you can set the plugin option [ forceEnable ] as true to enable it."),"interface"!==u.id||!u.enableTrace)continue;u.onlyForTrace=!0}if(u.plugin&&d(u.plugin))Y(t,u);else{var p=Z(u.id);d(window[p])?(t.print(u.id+" plugin already exists in window, init it immediately"),$(t,u)):(o.push(u),s.push("itrace-"+u.id+".iife.js"))}}else t.print("plugin options has no id, base sdk will ignore it")}!function(t,e,r){if(r.length<=0)t.print("no plugins need load from cdn");else{var n=(t.cdn||"https://g.alicdn.com/woodpeckerx/itrace-next")+"/??",i=document.getElementsByTagName("script")[0],o=document.createElement("script");if(o.type="text/javascript",o.crossOrigin="anonymous",o.async=!0,i&&i.parentNode)i.parentNode.insertBefore(o,i);else{var s=document.head;null==s||s.appendChild(o)}o.src=n+r.join(","),o.onload=function(){for(var r,n=O(e);!(r=n()).done;){var i=r.value;$(t,i)}}}}(t,o,s)}function et(){var t;if(!A)return{};var e=A.referrer;e&&-1!==e.indexOf('"')&&(e=encodeURIComponent(A.referrer));var r,n=function(){if(void 0===C){var t=(j?j.userAgent:"").toLowerCase();C=t.indexOf("electron/")>-1}return C}()?"renderer":void 0,i=null==(t=N.__itracecfg__)?void 0:t.wv_traceid,o=j.deviceMemory||-1;return{w_url:(B.origin?B.origin:B.protocol+"//"+B.host)+B.pathname,w_query:B.search,w_ref:B.hash.substring(1),w_title:A.title,ua:j.userAgent,referrer:e,dsp_dpi:T||1,dsp_w:N.screen.width,dsp_h:N.screen.height,w_wv_traceid:i,wk_proc_type:n,wl_devmem:o,net:(r=j.connection,r&&r.type?"none"===r.type?"disconnected":"cellular"===r.type?"slow-2g"===r.effectiveType?"2g":r.effectiveType:r.type:"")}}var rt=function(t,e,r){if("function"==typeof XMLHttpRequest){var n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","text/plain"),n.timeout=5e3,n.send(r)}else t.print("xhr is not supported")},nt=function(t,e){b("webMonitor.reportWpkLog",e,(function(e){t.print("report success by jsapi",e)}),(function(e){t.print("report failed by jsapi",e)}))};function it(){return j&&!!j.sendBeacon&&N.Blob}var ot=function(t){try{return 1===((null==N?void 0:N.nativeWpkReport)||{})[t]}catch(t){return!1}};function st(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return at(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?at(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}!function(){if(!c(window)||!s(window.navigator))throw new Error("iTrace sdk only support")}();var ct=function(t){function r(e){var r;return(r=t.call(this,e)||this).uc_param_str="",r.cdn="",r._sdkEnv={},r._wid="",r._begin=0,r._sid="",r._frmId="",r._dyStart=0,r.spa=e.spa||!1,r.ignoreU4HA=!0===e.ignoreU4HA,r.checkHidden=!1!==e.checkHidden,r.supportBeaconBody=!1!==e.supportBeaconBody,r.maxSessDuration=e.maxSessDuration||288e5,r.immediatePV=!1!==e.immediatePV,r.uc_param_str=e.uc_param_str||"prveosfrnwutmisvbditcu",r.sdkVer="2.3.25",r.sdkCode="browser",r.beforeSend=e.beforeSend,r.clearBeforeunload=!1!==e.clearBeforeunload,r.cdn=e.cdn||"",r._logq=new k,r._dying=!1,r._prerender=e.prerender,r.useNativeCH=!1!==e.useNativeCH,!e.cluster&&w()&&(r.cluster=P.QUARK),r}!function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,e(t,r)}(r,t);var n=r.prototype;return n.prerenderCommit=function(){if(this._sdkEnv.hasPrerenderCommit)this.print("prerenderCommit can only call once");else{this.print("prerender commit event"),this._sdkEnv.hasPrerenderCommit=!0;var t=new Event("wpkpageforeground");window.dispatchEvent(t),this.reportImmediatePV(!0)}},n._listenCompassPrerenderEvt=function(){var t=this;V()&&(this._sdkEnv.prerenderType="compass",y(document,"prerendercommit",(function(){t.prerenderCommit()}),!1,!0),y(document,"touchstart",(function(){t.prerenderCommit()}),!1,!0))},n._loadPlugins=function(){if(u(this.plugins)&&this.plugins.length>0)try{tt(this,this.plugins)}catch(t){this._reportToSelf(t,{c1:"插件初始化异常"})}},n._normalizeLog=function(t){var e=t.uid||this.uid||this._wid,r=t.rel||this.rel,n=et(),i=p(t.category),o=g({uid:e,utdid:t.utdid||this.utdid,wid:this._wid,type:i,category:t.category,w_cnt:1,w_rel:r,w_bid:t.bid||this.bid,w_cid:t.cid||this.cid||void 0,w_spa:this.spa,w_frmid:this._frmId,w_tm:f(),log_src:this.logSrc,sdk_ver:this.sdkVer,uc_param:this.uc_param},n,t),s=this._genReportUrl(o,!0);return o._url=s,o._hash=function(t){var e="";switch(t.category){case 1:e=[t.category,t.uid,t.w_url,t.w_ref,t.w_msg||"",t.w_line||"",t.w_col||""].join("");break;case 2:e=[t.category,t.uid,t.w_res,t.w_method,t.w_rc].join("");break;case 4:e=[t.category,t.uid,t.w_url,t.w_ref,t.w_res,t.w_type].join("")}return e}(o),o},n._genReportUrl=function(t,e){var r={app:t.w_bid||this.bid,cp:"none",de:e?4:1,seq:""+Math.floor(+new Date/1e3)+Math.floor(1e4*Math.random()),tm:f(!0),ud:encodeURIComponent(t.uid||this.uid||this._wid),ver:t.rel||this.rel,type:t.type||p(t.category),sver:this.sdkVer,sign:"9bf8a190ef82c5049df7b199c599c45b"};return L.getAddr(this.cluster,this.gateway)+"?wpk-header="+encodeURIComponent(l(r))+(this.uc_param_str&&!this.uc_param?"&uc_param_str="+this.uc_param_str:"")},n.send=function(t,e,r){if(r)rt(this,t,e);else if(s(e)){navigator.sendBeacon(t,e)||(this.print("beacon send fail, retry by xhr"),rt(this,t,e))}else this._sdkEnv.supportBeacon?navigator.sendBeacon(t):(n=t,i="itraceimgreporter_"+f()+".r"+Math.floor(1e3*Math.random()),(o=N[i]=new Image).onload=o.onerror=function(){N[i]=null},o.src=n);var n,i,o;this.print("log is sent: ",t)},n.setReady=function(){var e=this;t.prototype.setReady.call(this),v((function(){e._sendQueuingLogs()}),0)},n._updateSpecialFields=function(t){return t._dirty?g(t,{w_bid:this.bid,w_cid:this.cid,w_rel:this.rel,uid:this.uid,utdid:this.utdid}):t},n._sendQueuingLogs=function(){if(this._logq.hasLog()){var t=this._logq.takeLogList(),e=t.length;if(this._sdkEnv.sendByJsapi)for(var r=0;r<e;r++)try{var n=t[r];n.w_send_mode="jsapi",n._url=void 0,this._updateSpecialFields(n),_(n),nt(this,{type:n.type,immediate:"jsfsperf"===n.type?0:1,args:n})}catch(t){this.print(t)}else if(this._sdkEnv.supportBeaconBody&&this.supportBeaconBody)for(var i,o=function(t){for(var e=[],r=[],n=t.length,i=0;i<n;i++){var o=t[i].category;-1===r.indexOf(o)&&r.push(o)}for(var s=r.length,a=0;a<s;a++){for(var c=r[a],u=[],d=0;d<n;d++){var p=t[d];p.category===c&&u.push(p)}e[a]=u}return e}(t),s=st(o);!(i=s()).done;){var a=i.value;try{for(var c,u=[],d=this._genReportUrl(a[0],!1),p=0,f=st(a);!(c=f()).done;){var l=c.value;this._updateSpecialFields(l),_(l),l.w_send_mode="beacon";var h=JSON.stringify(l),g=E(h);g>6e4?(this.send(this._genReportUrl(l,!1),h,!0),this.print("single log oversize 60k, send by xhr")):((p+=g)>6e4&&(this.send(this._genReportUrl(l,!1),u.join("\n")),this.print("group log length is "+p+" oversize 60k, send now"),u.splice(0,u.length),p=g),u.push(h))}u.length>0&&this.send(d,u.join("\n"))}catch(t){this.print(t)}}else for(var v=0;v<e;v++){var y=t[v],m=y._url||"",w=y._forcePost||!1;this._updateSpecialFields(y),_(y),y.w_send_mode=w?"fetch":it()?"beacon":"img";try{var b=JSON.stringify(y);(w=w||E(b)>7500)?(m=this._genReportUrl(y,!1),this.send(m,b,w)):(m+="&data="+encodeURIComponent(b),this.send(m))}catch(t){this.print(t)}}}else this.print("logq is empty.")},n._handlePreReporting=function(){var t=window.__iTraceLogQueue;if(u(t)&&t.length>0&&(this._logq.setPreLogList(t),window.__iTraceLogQueue=[],this.print("preLogList is updated")),this._logq.hasPreLog()){this.print("handling logq for pre-reporting");for(var e=this._logq.getPreLogList();e.length;){var r=e.shift(),n=null==r?void 0:r.shift();d(this[n])&&(this[n].apply(this,r),this.print(n+" is called by pre-reporting."))}}},n.resetSession=function(){var t;this._sid=(t=a(),K(H)&&H().setItem("wpkreporter:frmid",t),t),this._begin=Date.now(),this._frmId=this._sid},n._useU4Monitor=function(){return!this.ignoreU4HA&&q()&&function(t){if(s(document)&&document.getElementsByTagName)for(var e=document.getElementsByTagName("meta"),r=e.length,n=0;n<r;n++){var i=e[n];if(i.name===t)return i.content}return""}("wpk-bid")===this.bid},n.init=function(){var t;this._syncDyConf(),this._wid=((t=W(M))||(t=a(),W(M,t,15552e3)),t),this.resetSession(),this.initSdkEnv(),this._loadPlugins(),this._listenCompassPrerenderEvt();var e=this;v((function(){e.reportImmediatePV(),function(t,e){try{b("biz.ucparams",{params:t},(function(t){e.uc_param=t,e.print("get uc_param success",t)}),(function(t){e.print("get uc_param_str error: ",t)}))}catch(t){e.print("get uc_param_str error: ",t)}}(e.uc_param_str,e)}),0);var r=this._sdkEnv.isIOS?"pagehide":"beforeunload";y(window,r,(function(){(e.isReady()||e.clearBeforeunload)&&(e._sendQueuingLogs(),e.print("do clearing jobs on page unload~"))}),!0),this._sdkEnv.isPrerender&&this.print("预渲染场景下，白屏、性能检测时机为webview上屏之后")},n.initSdkEnv=function(){try{this._sdkEnv.useU4Monitor=this._useU4Monitor(),this._sdkEnv.isPrerender=V()||this._prerender,this._sdkEnv.iOSNBCheck=this.useNativeCH&&ot("enableBlankReport"),this._sdkEnv.sendByJsapi=this.useNativeCH&&ot("enablePerformanceReport"),this._sdkEnv.isIOS=/(iphone|ipad|ipod|ios)/i.test(m),this._sdkEnv.supportBeacon=!!it(),this._sdkEnv.supportBeaconBody=this._sdkEnv.supportBeacon&&!this._sdkEnv.isIOS,this.print("sdk env:",this._sdkEnv)}catch(t){this.print("init sdk env error",t)}},n.reportImmediatePV=function(t){void 0===t&&(t=!1),this._sdkEnv.useU4Monitor||this._sdkEnv.isPrerender&&!t||!this.immediatePV||this.reportFlow()},n.report=function(t){var e=this;if(this.print("reporting data:",t.category,t),!t||!t.category)return this;var r=t.sampleRate||this.sampleRate;if(r||0===r||(r=1),!h(r))return this.print("log is rejected by sampling rate, type: %s category: %s, rate: %s log: %o",t.type,t.category,r,t),this;Date.now()-this._begin>=this.maxSessDuration&&this.resetSession();try{var n=this._normalizeLog(t);if(this._dyConf&&Date.now()<this._dyConf.expireAt){var i=n.type+"@"+n.category,o=this._dyConf[i];if(s(o)||(i=n.type||"undefined",o=this._dyConf[i]),o=s(o)?o:this._dyConf.all,s(o)&&!h(o))return this.print("log is rejected by dynamic sampling rate, type: %s, category: %s, rate: %s log: %o",n.type,n.category,o,n),this}else!this._dying&&Date.now()-this._dyStart>=18e5&&(this.print("syncing dynamic config"),this._syncDyConf());if(this._handlePreReporting(),d(this.beforeSend))try{if(!1===this.beforeSend(n))return this.print("the beforeSend hook rejects this log"),this}catch(t){this.print("beforeSend hook error",t)}n.category===x.JSERR&&delete n.error;var a=this.isReady();if(n._dirty=!a,!this._logq.pushLog(n))return this.print("log merged: ",n),this;if(a)v((function(){e._sendQueuingLogs()}),!n._reportNow&&this.delay&&-1!==[1,2,4,8,15,18].indexOf(n.category||0)?1e3:-1);else this.print("sdk is not ready, you should call setReady to trigger reporting.")}catch(e){this.print("report failed: ",t,e),this._reportToSelf(e)}return this},n.reportFlow=function(t){var e=t||{};return e.category=x.PVUV,this.report(e),this},n.reportJSError=function(t,e){return!function(t){var e={}.toString.call(t);return("[object Error]"===e||"[object Exception]"===e||"[object DOMException]"===e||e instanceof Error)&&c(t)}(t)?this.print("the input is not a real JSError"):((e=e||{}).category=x.JSERR,e.w_msg=t.toString(),e.stack=function(t){if(t.stack){var e=t.stack.split("\n");return e.shift(),e.join("\n")}return""}(t),e.w_file=t.filename||"",e.w_line=t.lineno,e.w_col=t.colno,this.report(e)),this},n.reportApi=function(t){if(t){c(t.queryString)&&(t.queryString=l(t.queryString));var e=g(t,{category:x.API,w_type:16,w_res:t.url,w_method:t.method,w_param:t.queryString,w_body:"object"==typeof t.body?JSON.stringify(t.body):t.body,w_resp:t.response,w_rc:t.status,w_rt:t.spent||0},{url:void 0,queryString:void 0,response:void 0,body:void 0,status:void 0,spent:void 0});this.report(e)}return this},n.reportBlankPage=function(t){var e=t||{};return R(t,"w_fp")||(e=g(t,{w_fp:999})),e=g(e,{category:x.BKPG}),this.report(e),this},n.reportPerf=function(t){return this._hasReportPerfData?(this.print("do not repeat report performance data"),this):(this.print("manual report performance data"),this.__customPerfCache__=t,this)},n.detectBlank=function(t){return this.print("need itrace-blank plugin"),this},n.detectBlock=function(t,e){return this.print("need itrace-fluency plugin"),this},n._syncDyConf=function(){var t=L.getConfAddr(this.cluster,this.gateway),e=this;e._dyStart=Date.now(),e._dying=!0,X(e.bid,e.sdkVer,t,(function(t){e._dying=!1,e._dyConf=t,e.print("jconfig come back")}))},n._reportToSelf=function(t,e){void 0===e&&(e={});this.reportJSError(t,g({bid:"itrace-next"},e))},r}(S),ut=window;return ut[D]&&c(ut[D])&&!s(ut[U])&&(ut[U]=new ct(ut[D]),ut[U].init()),t.getItraceInstance=function(t){var e=t||ut[D]||{},r=new ct(e);return r.init(),r},t.getItraceSingleton=function(t){if(ut[U])return ut[U];var e=t||ut[D]||{};return ut[U]=new ct(e),ut[U].init(),ut[U]},t.iTraceReporter=ct,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
