(()=>{"use strict";const e="NWG";let o=function(e){return e.SlowNetWork="SNW",e.NormalNetWork="NNW",e}({});class t{constructor(e){this.scope=e}logMessage(e,o,t=!1){const n=`[${e}] [${this.scope}] ${(new Date).toISOString()}: ${o}`;t?console.error(n):window?._ecoNet_?.isDebug&&console.log(n)}info(e){this.logMessage("EcoNET:INFO",e)}error(e){this.logMessage("EcoNET:ERROR",e,!0)}}const n=new t("NetGradeInfo"),r="NetworkConfig";function i(){const e=function(){const e=localStorage.getItem(r);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}();if(e){const{__xconfig_meta__:o}=e;if(o){const{updateTime:e}=o;Date.now()-e>12096e5&&c().then((()=>{n.info("updateNetWorkConfig success")}))}return e}return c().then((()=>{n.info("updateNetWorkConfig success")})),{defaultNetworkSpeedThreshold:1957,defaultNetworkGrade:o.NormalNetWork}}function c(){return fetch("https://s.alicdn.com/@xconfig/EcoNet/networkSpeedMap").then((e=>e.json())).then((e=>{localStorage.setItem(r,JSON.stringify(e))})).catch((e=>n.error(e)))}const s=new t("Iframe");function d(o){const t=window._ecoNet_?.version,n=`https://s.alicdn.com/@g/icbu-fe/cdn-ecoNet/${t}/index.html`;s.info(`iframeSrc:${n}`);const r=function(e,o){let t=document.getElementById(o);return t||(t=document.createElement("iframe"),t.id=o,t.name=o,t.src=e,t.style.display="none",t.style.visibility="hidden",document.body.appendChild(t),t)}(n,"ecoNetIframe");r.onload=()=>{!function(e,o,t){window.addEventListener("message",(function o(t){"https://s.alicdn.com"===t.origin&&t.source===e.contentWindow&&(s.info(`Message from iframe: ${JSON.stringify(t.data)}`),"y"!==new URL(window.location.href).searchParams.get("ecoNet")&&document.body.removeChild(e),window.removeEventListener("message",o))})),e.contentWindow?e.contentWindow.postMessage(o,t):s.error("iframe contentWindow is null")}(r,{key:e,value:o},"https://s.alicdn.com")}}const a=new t("Cookie");function l(o){const t=function(e){const o=e.split(".");if(o.length>2)return"."+o.slice(-2).join(".");return e}(window.location.hostname);d(o),function(e,o,t){const n=new Date;n.setFullYear(n.getFullYear()+1);const r=navigator.userAgent.toLowerCase(),i=/(?:chrome|chromium|crios)\/(\d+)/;let c=/chrome|chromium|crios/.test(r),s=c?parseInt(r.match(i)?.[1]||""):0,d=`${e}=${o}; path=/; domain=${t}; expires=${n.toUTCString()}; Secure; SameSite=None`,a=`${e}=; path=/; domain=${t}; expires=Thu, 01 Jan 1970 00:00:00 GMT; Secure; SameSite=None`;c&&s>=118&&(d+="; Partitioned",document.cookie=a);document.cookie=d}(e,o,t),a.info(`setNetWorkGrade:${e} ${o}`),window._ecoNet_?window._ecoNet_.netWorkGrade=o:window._ecoNet_={netWorkGrade:o},a.info("setNetWorkGrade success")}function u(e,o=!0){return t="/sc.bb.ecoNet",n=`NetWorkGrade=${e}&isCookieWrote=${o}`,void(window.goldlog?window.goldlog.record(t,"CLK",n,"GET"):(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[t,"CLK",n,"GET"]}));var t,n}const w=new t("EcoNet");!async function(){const e=i();await function(e,o=1e3){return new Promise((t=>{let n=null;const r=()=>{e()&&(n&&clearInterval(n),t())};r(),document.addEventListener("DOMContentLoaded",r),n=setInterval(r,o)}))}((()=>void 0!==window.__BB_PARAMS__)),w.info(`EcoNet: window.__BB_PARAMS__ is ready ${window.__BB_PARAMS__}`),w.info(`EcoNet: window._ecoNet ${window._ecoNet_}`);const{networkSpeed:t}=window.__BB_PARAMS__.common;t<e.defaultNetworkSpeedThreshold?(w.info(`当前网络速度为${t}kb/s, 低于${e.defaultNetworkSpeedThreshold}kb/s, 定义为 ${o.SlowNetWork}`),u(o.SlowNetWork),l(o.SlowNetWork)):(w.info(`当前网络速度为${t}kb/s, 高于${e.defaultNetworkSpeedThreshold}kb/s, 定义为 ${o.NormalNetWork}`),u(o.NormalNetWork),l(o.NormalNetWork))}()})();